{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/Springboot 원리/",
    "result": {"data":{"cur":{"id":"2ef52ac8-ca31-5434-8222-2a28b98de15c","html":"<p>자바의 서블릿 컨테이너(Tomcat)가 실행되고, 스프링 컨테이너도 실행된다.</p>\n<p>스프링 프로젝트를 처음 생성했을 때 모습.\nmain() 메서드 이외엔 크게 볼게 없다, 하지만 정말 그럴까? 보이는게 다가 아니라는게 알기에 @SpringbootApplication 기저에 깔린 여러 동작원리를 살펴보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 최초의 모습</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>autoconfigure<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">SpringBootApplication</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@SpringBootApplication</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HellobootApplication</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">SpringApplication</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HellobootApplication</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>모든 imports 를 삭제하고, 어노테이션과 SpringApplication 도 삭제하여 main 메서드를 실행하면 아무일도 일어나지 않는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HellobootApplication</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>톰캣 서블릿 컨테이너와 스프링 컨테이너 모두 실행되지 않은 것을 볼 수 있다.</p>\n<p>이제 <code class=\"language-text\">직접</code> 서블릿 컨테이너를 띄우고, 내부에 서블릿을 추가해보자.\n여기서 서블릿이란 서블릿 컨테이너에 들어가는 웹 컴포넌트를 의미한다.</p>\n<p>우선 빈(empty) 서블릿 컨테이너를 띄워보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>embedded<span class=\"token punctuation\">.</span>tomcat<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TomcatServletWebServerFactory</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">WebServer</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>boot<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>servlet<span class=\"token punctuation\">.</span>server<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ServletWebServerFactory</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HellobootApplication</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">ServletWebServerFactory</span> serverFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TomcatServletWebServerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">WebServer</span> webServer <span class=\"token operator\">=</span> serverFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getWebServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        webServer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>WebserFactory 를 상속받는 ServletWebFactory <code class=\"language-text\">팩토리</code> 인터페이스가 등장한다. 내부에는 getWebServer() 추상 메서드가 정의돼 있습니다.\ngetWebServer() 메서드는 주석에도 나왔듯 설정이 완료된<code class=\"language-text\">fully configured</code> 일시정지<code class=\"language-text\">paused</code> 상태의 WebServer 인스턴스를 생성합니다. 즉 실행되기 전 상태의 WebServer 인스턴스.\n<img src=\"https://velog.velcdn.com/images/tbnsok40/post/fc470a62-a7e2-4e88-9432-fb8a04290888/image.png\" alt=\"\"></p>\n<p>그렇게 생성된 webServer의 start() 를 호출하면 톰캣 서블릿 컨테이너가 실행됩니다.\n<img src=\"https://velog.velcdn.com/images/tbnsok40/post/be2da107-afe1-4355-a3c0-8cbfceb326a7/image.png\" alt=\"\"></p>\n<p>서블릿 컨테이너가 생성됐으니, 컨테이너에 들어갈 컴포넌트(서블릿)를 생성해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HellobootApplication</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">ServletWebServerFactory</span> serverFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TomcatServletWebServerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">WebServer</span> webServer <span class=\"token operator\">=</span> serverFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getWebServer</span><span class=\"token punctuation\">(</span>servletContext <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            servletContext<span class=\"token punctuation\">.</span><span class=\"token function\">addServlet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpServlet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token annotation punctuation\">@Override</span>\n                <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> req<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> resp<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n                    resp<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span>OK<span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    resp<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpHeaders</span><span class=\"token punctuation\">.</span>CONTENT_TYPE<span class=\"token punctuation\">,</span> <span class=\"token class-name\">MediaType</span><span class=\"token punctuation\">.</span>TEXT_PLAIN_VALUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    resp<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello Servlet\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        webServer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>getWebServer() 의 인자에 람다식을 사용하여 서블릿을 추가합니다.\nservletContext.addServlet() 메서드는 첫번째 인자로 <code class=\"language-text\">서블릿의 이름을 문자열</code>로 받고, 두번째 인자로 <code class=\"language-text\">서블릿 인스턴스</code>를 받습니다.</p>\n<p>서블릿 인스턴스에 해당하는 HttpServlet() 만 분리한 코드입니다.\nResponse 는 <code class=\"language-text\">Status, Header, Body</code> 세 부분으로 이루어진 점을 고려해 응답할 정보를 resp 변수에 담는 것을 볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpServlet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token annotation punctuation\">@Override</span>\n                <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> req<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> resp<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n                    resp<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span>OK<span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    resp<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpHeaders</span><span class=\"token punctuation\">.</span>CONTENT_TYPE<span class=\"token punctuation\">,</span> <span class=\"token class-name\">MediaType</span><span class=\"token punctuation\">.</span>TEXT_PLAIN_VALUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    resp<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello Servlet\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span></code></pre></div>\n<p>그렇게 서블릿 컨테이너에 추가된 서블릿을 addMapping() 메서드를 사용해 <code class=\"language-text\">/hello</code> URL에 바인딩 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">servletContext<span class=\"token punctuation\">.</span><span class=\"token function\">addServlet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpServlet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>생각해보면 new HttpServlet() 에 해당되는 내용은 우리가 흔히 사용하는 Controller의 역할을 하고 있습니다.</p>\n<h4 id=\"프론트-컨트롤러\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%A0%ED%8A%B8-%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC\" aria-label=\"프론트 컨트롤러 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프론트 컨트롤러</h4>\n<ul>\n<li>역할 : 모든 서블릿에 등장하는 공통적인 처리(<code class=\"language-text\">인증, 보안, 다국어</code>)를 가장 앞단의 컨트롤러에서 담당. 즉 모든 웹 요청에 공통적으로 처리 필요한 요청을 처리.</li>\n<li>프론트 컨트롤러는 받은 모든 요청을 적절히 다른 컨트롤러에 <code class=\"language-text\">위임</code>한다.</li>\n</ul>\n<h3 id=\"스프링-컨테이너-사용\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%82%AC%EC%9A%A9\" aria-label=\"스프링 컨테이너 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스프링 컨테이너 사용</h3>\n<ul>\n<li><code class=\"language-text\">컨테이너</code>는 여러 오브젝트를 보관하고 필요할 때 꺼내 사용할 수 있도록 관리한다.</li>\n<li>스프링 컨테이너의 동작방식</li>\n<li>크게 2가지 필요\n<ul>\n<li>POJO : 비즈니스 로직을 담당 (비즈니스 로직과 관련없는 클래스를 상속할 필요 X)</li>\n<li>Configuration Metadata : 컨테이너 구성 정보</li>\n</ul>\n</li>\n<li><strong>정리하면</strong> 스프링 컨테이너는 1) POJO 라는 Business Objects 와 2) Configuration Metadata 를 조합하여 서버 어플리케이션으로 사용할 수 있는 시스템을 만든다.\n<img src=\"https://velog.velcdn.com/images/tbnsok40/post/abe288ab-56f1-4fa7-bc75-82a2604b2af6/image.png\" alt=\"\"></li>\n</ul>\n<p>위 그림의 초록 상자, Full Configured System은 사실 스프링 컨테이너 내부에 위치한다.</p>\n<hr>\n<p><code class=\"language-text\">ApplicationContext</code> : 스프링 컨테이너를 대표하는 인터페이스. 개발자가 수동으로 스프링 컨테이너를 띄울 일이 생긴다면 기억해야 할 인터페이스로, ApplicationContext가 곧 Spring Container.</p>\n<p>registerBean() 메서드를 사용해 스프링 컨테이너에 등록할 오브젝트를 추가한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HellobootApplication</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token comment\">//</span>\n        <span class=\"token class-name\">GenericApplicationContext</span> applicationContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GenericApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">registerBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HelloController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">registerBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SimpleHelloService</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">ServletWebServerFactory</span> serverFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TomcatServletWebServerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">WebServer</span> webServer <span class=\"token operator\">=</span> serverFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getWebServer</span><span class=\"token punctuation\">(</span>servletContext <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        webServer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>아래 코드는 HelloController 클래스를 Bean 오브젝트로 생성을 의미한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">registerBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HelloController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// HelloController.class 라는 메타정보를 주입</span></code></pre></div>\n<p>이렇게 스프링 컨테이너에 빈이 등록되면, 서블릿 컨테이너에서 필요한 빈을 꺼내 사용(매핑)한다.</p>\n<ul>\n<li>applicationContext.registerBean() : 스프링의 구성정보를 만들 땐(bean 생성할 땐) 정확히 어떤 클래스를 가지고 만들 것인지 <code class=\"language-text\">구체 클래스</code>를 적어야 한다.</li>\n<li>어떤 빈을 만들던 순서는 고려하지 않아도 된다. 스프링 컨테이너가 자동으로 순서문제를 해결한다.</li>\n</ul>\n<h3 id=\"스프링-컨테이너는-싱글톤-빈을-생성\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EB%8A%94-%EC%8B%B1%EA%B8%80%ED%86%A4-%EB%B9%88%EC%9D%84-%EC%83%9D%EC%84%B1\" aria-label=\"스프링 컨테이너는 싱글톤 빈을 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스프링 컨테이너는 싱글톤 빈을 생성</h3>\n<p><img src=\"https://velog.velcdn.com/images/tbnsok40/post/24535a45-3a1c-4dee-a03b-327eda562424/image.png\" alt=\"\"></p>\n<ul>\n<li>서블릿 컨테이너의 Front Controller(서블릿) 뿐만 아니라 다른 서블릿에서도 스프링 컨테이너의 HelloController(Bean) 오브젝트를 필요로 할 수 있다.</li>\n<li>이 때 필요할 때마다 새로운 HelloController Bean 을 생성하지 않고, 스프링 컨테이너가 단 한번 생성해둔 HelloController Bean 을 재사용하는 방식으로 동작한다 => <code class=\"language-text\">싱글톤</code></li>\n<li>스프링 컨테이너는 특별히 싱글톤 패턴을 구현하지 않지만 싱글톤 기능을 제공하기 때문에 스프링 컨테이너를 <code class=\"language-text\">싱글톤 레지스트리</code>라 부른다.</li>\n</ul>\n<h3 id=\"스프링-컨테이너의-역할\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%9D%98-%EC%97%AD%ED%95%A0\" aria-label=\"스프링 컨테이너의 역할 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스프링 컨테이너의 역할</h3>\n<ul>\n<li>메타 정보를 주입하면 클래스의 싱글톤 오브젝트를 생성\n<ul>\n<li>주입 : 의존대상의 <code class=\"language-text\">레퍼런스</code>를 넘겨준다. 가장 잘 알려진 생성자 주입 방식으로 넘겨줄 수도 있고, 프로퍼티를 정의하여 setter로 레퍼런스를 넘겨줄 수도 있다.</li>\n</ul>\n</li>\n<li>생성할 오브젝트가 의존하는 다른 클래스가 있다면, 의존 대상 오브젝트를 주입하는 역할도 담당한다.</li>\n</ul>\n<p>아래 코드의 메커니즘을 요약하자면\n(1) Spring Container 생성\n(2) Spring Container 에 필요한 오브젝트 등록하여 <code class=\"language-text\">Bean</code> 생성\n(3) Servlet Container 내부에서는 필요한 Spring Bean 을 꺼내 사용하기 위해 <code class=\"language-text\">applicationContext.getBean(HelloController.class);</code> 호출\n(4) 비즈니스 로직은 getBean() 으로 꺼낸 helloController.hello()에 의해 처리되고, 그 결과를 응답 변수에 담아 클라이언트에게 리턴한다. (클라이언트에 리턴하는 로직은 해당 코드에 나타나지 않는다)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HellobootApplication</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Spring Container 생성 - (1)</span>\n        <span class=\"token class-name\">GenericApplicationContext</span> applicationContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GenericApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// Spring Container 에 Bean 등록(주입) - (2)</span>\n        applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">registerBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HelloController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">registerBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SimpleHelloService</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">ServletWebServerFactory</span> serverFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TomcatServletWebServerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">WebServer</span> webServer <span class=\"token operator\">=</span> serverFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getWebServer</span><span class=\"token punctuation\">(</span>servletContext <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            servletContext<span class=\"token punctuation\">.</span><span class=\"token function\">addServlet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpServlet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token annotation punctuation\">@Override</span>\n                <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> req<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> resp<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestURI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span>GET<span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                        <span class=\"token comment\">// Servlet Container 내부 Spring Container 에서 필요한 빈을 꺼내 사용 - (3)</span>\n                        <span class=\"token class-name\">HelloController</span> helloController <span class=\"token operator\">=</span> applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HelloController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token class-name\">String</span> ret <span class=\"token operator\">=</span> helloController<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                        resp<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaType</span><span class=\"token punctuation\">.</span>TEXT_PLAIN_VALUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        resp<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                        resp<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span>NOT_FOUND<span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        webServer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"dispatcherservlet-으로-전환\" style=\"position:relative;\"><a href=\"#dispatcherservlet-%EC%9C%BC%EB%A1%9C-%EC%A0%84%ED%99%98\" aria-label=\"dispatcherservlet 으로 전환 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DispatcherServlet 으로 전환</h3>\n<ul>\n<li>매핑/요청 파라미터 <code class=\"language-text\">바인딩</code> 등의 기능이 서블릿 컨테이너 코드 내부에 모두 드러난다 -> 서블릿 등록하는 코드를 모두 없애고 <code class=\"language-text\">DispatcherServlet</code>으로 대체한다.</li>\n<li>요약 : HttpServlet(Front Controller) -> DispatcherServlet 으로 대체</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 기존</span>\n<span class=\"token class-name\">WebServer</span> webServer <span class=\"token operator\">=</span> serverFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getWebServer</span><span class=\"token punctuation\">(</span>servletContext <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            servletContext<span class=\"token punctuation\">.</span><span class=\"token function\">addServlet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpServlet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token annotation punctuation\">@Override</span>\n                <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> req<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> resp<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ServletException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">IOException</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token comment\">// 인증, 보안, 다국어, 공통 기능</span>\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">getRequestURI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/hello\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpMethod</span><span class=\"token punctuation\">.</span>GET<span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                        <span class=\"token class-name\">HelloController</span> helloController <span class=\"token operator\">=</span> applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HelloController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token class-name\">String</span> ret <span class=\"token operator\">=</span> helloController<span class=\"token punctuation\">.</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                        resp<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MediaType</span><span class=\"token punctuation\">.</span>TEXT_PLAIN_VALUE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        resp<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>ret<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                        resp<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span>NOT_FOUND<span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token comment\">// 개선</span>\n<span class=\"token class-name\">WebServer</span> webServer <span class=\"token operator\">=</span> serverFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getWebServer</span><span class=\"token punctuation\">(</span>servletContext <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            servletContext<span class=\"token punctuation\">.</span><span class=\"token function\">addServlet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dispatcherServlet\"</span><span class=\"token punctuation\">,</span>\n\t\t\t\t\t\t\t\t\t\t<span class=\"token keyword\">new</span> <span class=\"token class-name\">DispatcherServlet</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Servlet Container에 hello 라는 개별 서블릿(HttpServlet)을 등록하는 대신 dispatcherServlet 을 등록하고 동시에 Spring Container 인 applicationContext 를 생성자 주입받는다. 이렇게 하면 스프링 컨테이너에 미리 등록된 Bean을 DispatcherServlet에서 인지할 수 있다.</p>\n<ul>\n<li>DispatcherServlet은 @RestController 가 붙어있으면, 모든 메서드에 @ResponesBody가 붙어있다고 간주한다.</li>\n</ul>\n<ul>\n<li>아래 코드는 두 부분으로 나뉜다.</li>\n<li>스프링 컨테이너가 먼저 만들어지고, 서블릿 컨테이너를 생성한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token comment\">// Spring Container생성 및 Bean 등록 (1)</span>\n        <span class=\"token class-name\">GenericWebApplicationContext</span> applicationContext <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">GenericWebApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">registerBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HelloController</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">registerBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SimpleHelloService</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        applicationContext<span class=\"token punctuation\">.</span><span class=\"token function\">refresh</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 스프링 컨테이너 초기화</span>\n\n\t\t<span class=\"token comment\">// ServletContainer 초기화 (2)</span>\n\t\t<span class=\"token comment\">// DispatcherServlet을 ServletContainer에 등록</span>\n        <span class=\"token class-name\">ServletWebServerFactory</span> serverFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TomcatServletWebServerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">WebServer</span> webServer <span class=\"token operator\">=</span> serverFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getWebServer</span><span class=\"token punctuation\">(</span>servletContext <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            servletContext<span class=\"token punctuation\">.</span><span class=\"token function\">addServlet</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dispatcherServlet\"</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token keyword\">new</span> <span class=\"token class-name\">DispatcherServlet</span><span class=\"token punctuation\">(</span>applicationContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        webServer<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>","excerpt":"자바의 서블릿 컨테이너(Tomcat)가 실행되고, 스프링 컨테이너도 실행된다. 스프링 프로젝트를 처음 생성했을 때 모습.\nmain() 메서드 이외엔 크게 볼게 없다, 하지만 정말 그럴까? 보이는게 다가 아니라는게 알기에 @SpringbootApplication 기저에 깔린 여러 동작원리를 살펴보겠습니다. 모든 imports 를 삭제하고, 어노테이션과 SpringApplication 도 삭제하여 main 메서드를 실행하면 아무일도 일어나지 않는다. 톰캣 서블릿 컨테이너와 스프링 컨테이너 모두 실행되지 않은 것을 볼 수 있다. 이제  서블릿 컨테이너를 띄우고, 내부에 서블릿을 추가해보자.\n여기서 서블릿이란 서블릿 컨테이너에 들어가는 웹 컴포넌트를 의미한다. 우선 빈(empty) 서블릿 컨테이너를 띄워보자. WebserFactory 를 상속받는 ServletWebFactory  인터페이스가 등장한다. 내부에는 getWebServer() 추상 메서드가 정의돼 있습니다.\ngetWebServ…","frontmatter":{"date":"April 30, 2023","title":"Springboot 원리 알아가기","categories":"springboot","author":"Hoo","emoji":"🌿🤙🏻"},"fields":{"slug":"/Springboot 원리/"}},"next":{"id":"618bb7aa-9cb3-51d5-922b-e3764e890587","html":"<p>처음 글또를 시작했던 <a href=\"https://junior-datalist.tistory.com/149\">2021년 7월의 글</a></p>\n<p>6기, 7기를 거쳐 8기에 참여하게 됐다. 내가 애정하는 커뮤니티가 점점 커지는 모습을 보니 뿌듯하다. 기여한 건 별로 없지만 ㅎ..</p>\n<h3 id=\"글또-8기-다짐\" style=\"position:relative;\"><a href=\"#%EA%B8%80%EB%98%90-8%EA%B8%B0-%EB%8B%A4%EC%A7%90\" aria-label=\"글또 8기 다짐 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>글또 8기 다짐</h3>\n<ul>\n<li>8기 회고 글 제출\n<ul>\n<li>6기의 다짐글을 다시 읽으니, 2년 전의 나는 어떤 주제에 관심을 가졌고, 무슨 목표가 있었는지 되돌아볼 수 있었다. 이런 류의 기록이 많이 남지 않아 아쉬웠다. 회고를 패스로 대체한 것도 살짝 후회했다.</li>\n<li>한 기수의 마무리와 소회를 글로 남겨둘 수 있는 건 큰 행운이다. 기억은 휘발되고 왜곡될 수 있지만, 기록은 그 자체로 남는다, Immutable U know.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"no-pass\" style=\"position:relative;\"><a href=\"#no-pass\" aria-label=\"no pass permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>No Pass</h3>\n<ul>\n<li>7기 때 벌금(?)을 내진 않았지만 패스는 2회 모두 사용했다. 이번 기수는 No Pass 가 목표다. 쓸 주제는 차고 넘치는데, 뭘 써야 할지 모르겠다는 핑계를 대지 않았으면 한다. 긴장하라 미래의 나</li>\n</ul>\n<h3 id=\"영양가-있는-글-제출\" style=\"position:relative;\"><a href=\"#%EC%98%81%EC%96%91%EA%B0%80-%EC%9E%88%EB%8A%94-%EA%B8%80-%EC%A0%9C%EC%B6%9C\" aria-label=\"영양가 있는 글 제출 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>영양가 있는 글 제출</h3>\n<ul>\n<li>추상적인 다짐이지만 내가 생각하는 영양가 있는 글은 ‘문제 해결 과정과 결과가 정리된 글 / 흔히 접할 수 없는 리뷰’ 등 이 있다.</li>\n<li>블로그는 평소에도 꾸준히 쓰고 있었지만, 글또에 제출할 성격의 글은 아니라고 판단했다. 그나마 최근 쓴 글 중에선 @Cacheable 메서드 내부 호출 개선하기 (feat. self invocation)이 적당한데, 여기선 문제를 어떤 방법들로 해결했는지 기술할 수 있어 만족스러웠다. 이런 식의 글을 많이 쓸 수 있길 바란다!</li>\n<li>흔히 접할 수 없는 리뷰는, Nextstep의 ATDD 과정을 들으면서 생각했다. 고가의 강의인만큼 많은 사람들이 궁금해할 것으로 예상한다. 잘 수료해서 리뷰글을 남기도록 해야지.</li>\n</ul>\n<h3 id=\"커피챗-6회-이상-참여-현재-16\" style=\"position:relative;\"><a href=\"#%EC%BB%A4%ED%94%BC%EC%B1%97-6%ED%9A%8C-%EC%9D%B4%EC%83%81-%EC%B0%B8%EC%97%AC-%ED%98%84%EC%9E%AC-16\" aria-label=\"커피챗 6회 이상 참여 현재 16 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>커피챗 6회 이상 참여 (현재 1/6)</h3>\n<ul>\n<li>‘커피챗 활발히 참여’로 썼다가 수치화해 두는 게 좋을 것 같아 수정했다. 어제 슬기님 덕분에 조찬모임에 참여했다. 기대했던 만큼 유익한 시간이었다. 혼자 지내는 시간이 길다 보니 종종 내 생각에 갇히는 경우가 있는데, 여러 개발자 분들과 만나면 다양한 생각과 세계를 알 수 있어 즐겁다.</li>\n</ul>\n<h3 id=\"분야를-넓혀-활동하기\" style=\"position:relative;\"><a href=\"#%EB%B6%84%EC%95%BC%EB%A5%BC-%EB%84%93%ED%98%80-%ED%99%9C%EB%8F%99%ED%95%98%EA%B8%B0\" aria-label=\"분야를 넓혀 활동하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>분야를 넓혀 활동하기</h3>\n<ul>\n<li>이것 역시 추상적인 다짐인데,,, 글또가 단순히 글쓰기 모임은 아니라고 생각했다. 글또 내에서 자연스레 여러 소모임과 채널이 생기고 있다. 글을 쓰는 것이 주 목표인 모임이지만, 그 외의 모든 일도 주체적이고 자발적으로 진행할 수 있는 커뮤니티로 성장했다고 느낀다.</li>\n<li>쓰라는 글은 안쓰고 소모임/채널에서만 활발히 스레드를 달고 있다. 현재 달려또와 감사해또, 카페가또, 뮤지크스타또 등에서 활동중인데\u001c그 안에서 만난 분들과도 새로운 교류를 하고 싶다. 새로운 분야의 사람을 만날 때 나의 세계가 넓어지는 느낌을 격렬히 환영하는 편인데, 실제로 저번 기수에 만난 글또 분들 덕분에 경험하지 못할 다양한 일들을 내 삶으로 끌어 당길 수 있었다. 이번 기수에선 주체적으로 새로운 세계를 당겨오고 싶다.</li>\n</ul>\n<br>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 424px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 112.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAACu0lEQVQ4y72U20/TUBzH918YE/4FE2Kiz/qoT/rGg4nxGnxDZArICBc3AgMDgYTQIJaRDHAOkMjQGFe5mDEVlEy20W3ChBG2jsUN2l3br2lhDbK1ijF+k5Oe5vR8zre/y9EIgoB/OTT/DwiA53nwuZw8/hooSuB5FJO8fiyHBzBmexvUqAmjbQ34RL1BToAqTNUhl0yhtewC7peehOFsCepKT2CouVp2f/jbw+4LgLlcTlr8Mkeh6eIZ+GdH0Hj5HHSnS9Bw/hT2WBZKUgUuzVGovHIJnrnnILsfwd5vQOfdm0hnMpiZmYHFYkFvby90Oh20Wi2MRiMymYzyL8d+xDE7SeL9BIE1xxhirilMTU1KmU8mk2AYBqFQCH6/Hw6HAy6XSz2G8cQuPn9cwNrSW9DOVwj6PdhjOdD0Kra2tgril5emGEx04fV6pXkqnQWbTP+yqa+vD1arVZpns9n9ej1IVFEgw0SxGQrB5/NBEPZLKJ1Oo6OjAz09PQgEvkFXX49olNk3IPDKZSPK6/6KVa8HKysrEiivgSf9KC+/A31jHZ6ZTUgkdgvqsijQOkTgw7wdgbV10D4fkhyHVCoFy/gE7lVp8fLFONi9hByew9CiwHg8IVYvHhMkbtUaUNFkxO3qJlyrMaClm5AdH4WpZzkeR5WhE1drWjAwYsW47TVuPGxBpaEL4XBYsQULgPlT14Pfcb1Gj67+IdnR09ExlFXo4HJ7pPdckRtI0aGdeofa5lZshyMycCcWw4PmNsw7FhRvHc1RUP7kSCSC2E5USgbLsvJ6JByWalQMCSCox1AURVEgCALDw8MgBwfR3t4OkiRhs9mg1+thNpuxvLyM6elpmEwmcBynnGVRGxsbWFxchNPplJ6im2AwiEAgIPWs3W4HTdNS77rdbvkyUS2b4+q3Scn35p+Mo0n5CVDWsBcubbWvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/f2bbb84f72923ee2b1496064722510f5/1cfa9/img.png\"\n        srcset=\"/static/f2bbb84f72923ee2b1496064722510f5/e9ff0/img.png 180w,\n/static/f2bbb84f72923ee2b1496064722510f5/f21e7/img.png 360w,\n/static/f2bbb84f72923ee2b1496064722510f5/1cfa9/img.png 424w\"\n        sizes=\"(max-width: 424px) 100vw, 424px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n출처: IG @waterglasstoon</p>","frontmatter":{"date":"February 06, 2023","title":"글또 8기 다짐","categories":"글또","author":"Hoo","emoji":"🌿🤙🏻"},"fields":{"slug":"/글또 8기 다짐/"}},"prev":{"id":"59131f27-6acd-5570-828b-5f2a6a725a57","html":"<p>아마존의 OTT <code class=\"language-text\">Prime Video</code> 의 결함 감지 서비스를 MSA에서 모놀리스 아키텍처로 마이그레이션한 사례입니다.\n보통은 모놀리스에서 MSA로 마이그레이션한 사례만 접했는데, 해당 사례는 역으로 마이그레이션 한 케이스라 흥미롭습니다.\n원문은 <a href=\"https://www.primevideotech.com/video-streaming/scaling-up-the-prime-video-audio-video-monitoring-service-and-reducing-costs-by-90\">🔗Prime Video 테크 블로그</a>에서 확인하실 수 있습니다.</p>\n<hr/>\n<br/>\n<blockquote>\n<p>분산형 마이크로서비스 아키텍처에서 모놀리스 애플리케이션으로 전환하여 더 높은 규모, 내구성을 달성하고 비용을 줄일 수 있었습니다.</p>\n</blockquote>\n<br/>\n<p>프라임 비디오(이하 프라임)에서는 수천개의 라이브 스트림을 고객에게 제공합니다.\n원할한 영상 제공을 위해 프라임에서는 고객이 시청하는 모든 영상을 모니터링 하고 있습니다.\n모니터링 툴 덕분에 사용자가 느끼는 품질 문제(예: 차단 손상 또는 오디오/비디오 동기화 문제)를 자동으로 식별하고 이를 해결하기 위한 프로세스를 시행할 수 있습니다.</p>\n<p>프라임의 비디오 품질 분석 팀은 오디오/비디오 품질 검사 도구를 이미 보유하고 있었지만, 대규모 라이브 스트림을 모니터링 하기 위해 설계된 것은 아니었습니다.\n서비스에 더 많은 영상을 추가하는 과정에서 대규모의 인프라를 실행할 때 많은 비용이 든다는 사실과 스트림 모니터링 시 방해되는 병목 현상 역시 발견했습니다.\n그래서 우리는 비용 문제와 스케일링시 병목 현상에 초첨을 맞춰 기존 서비스의 아키텍처를 검토 했습니다.</p>\n<p>초기의 프라임은 AWS Step Functions 으로 오케스트레이션 되는 분산 서버 형태로 구성되어 있었습니다.\n비용 측면에서 가장 비싼 태스크는 오케스트레이션 워크플로우와 분산된 컴포넌트 간 데이터 전송이었습니다.\n이 문제를 해결하기 위해 모든 구성 요소를 Single Process 로 옮겨 프로세스 메모리 내에서 데이터 전송을 유지하여 오케스트레이션 로직도 간소화했습니다.\n모든 작업을 단일 프로세스로 컴파일한 덕분에 배포를 위해 확장 가능한 EC2 및 ECS 인스턴스를 사용할 수 있었습니다.</p>\n<br/>\n<h3 id=\"분산-시스템에서의-오버헤드\" style=\"position:relative;\"><a href=\"#%EB%B6%84%EC%82%B0-%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%97%90%EC%84%9C%EC%9D%98-%EC%98%A4%EB%B2%84%ED%97%A4%EB%93%9C\" aria-label=\"분산 시스템에서의 오버헤드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>분산 시스템에서의 오버헤드</h3>\n<p>프라임은 세 가지 주요 컴포넌트로 이루어져 있습니다.</p>\n<ol>\n<li><code class=\"language-text\">미디어 변환기</code>는 입력 오디오/비디오 스트림을 프레임 또는 해독된 오디오 버퍼로 변환하여 Detector 로 전송합니다.</li>\n<li><code class=\"language-text\">Defect Detector</code> 는 프레임과 오디오 버퍼를 실시간으로 분석하여 결함(비디오 정지, 블록 손상 또는 오디도/비디오 동기화 문제 등)을 탐지하고 결함 발견 시 실시간 알림을 보냅니다.</li>\n</ol>\n<p>이 내용에 대한 자세한 내용은 ”<a href=\"https://www.primevideotech.com/computer-vision/how-prime-video-uses-machine-learning-to-ensure-video-quality\">프라임 비디오가 머신 러닝을 사용하여 동영상 품질을 보장하는 방법</a>” 문서를 참조하세요.\n3. <code class=\"language-text\">오케스트레이션</code>은 서비스 내의 흐름을 제어하는 기능을 제공합니다.</p>\n<p>프라임의 초기 솔루션은 서버리스 컴포넌트(AWS Step Functions 나 AWS Lambda)를 사용하는 분산 시스템으로 설계했는데, 빠르게 서비스를 구축할 수 있는 적절한 선택이었습니다.\n이론적으로는 각 서비스 컴포넌트를 독립적으로 확장할 수 있었지만, 일부 컴포넌트의 사용 방법으로 인해 예상 부하의 5% 정도 규모에서 한계에 부딪혔습니다.\n또한 모든 컴포넌트의의 전체 비용이 너무 높아 대규모 솔루션으로 적용하기엔 무리였습니다.</p>\n<p>아래 다이어그램은 프라임의 서버리스 아키텍처입니다. <br/></p>\n<p><strong>📌 Defect Detection 시스템의 초기 아키텍처</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC/klEQVQ4y2WUu47cNhSGp0iTKk2eJ1XewGnSpki6PIABI5XhAEmRJo2NXB7BWPhSxLkWARwDjuHcdmfXu7OzE81II1GkKFKkRPILpFljLznAAQke6j/n/P+hZgAppQuPkXjJRzPGImo57YfaYM4qfN/jnCfGxGWbTZf6fvKYIj4MiFpM3jTNdClbbzg4PCKRkEVFsfh3Agwh0miNUhIhBH3f7wDHOqY8fSB1PWEYiEOYnJhojaeSFmssJycnLBanSFETQ8TaDq31lHzscBa8RW+OiATMg5eoTx/Rtw5fKHypcbnCLQ+wx78RTYsfY60lWI83HW2prrZsnu9Rf/I25vdv0SpiCoF1Dq1bWmNwfUTfew93600Q8/PPdrxFEla2EONEx1Rh9fdTll99hNz/iX6AGALWWuq6RjUNIUJ+/w753fcZZLaDG8VKiRAjRuqJlnQu7qztHFml6YZI7DwpRK6b1IaNUKRr5zGl/wNOKjvPep3R1g3B9+i8ppENWiqUUJPKq/kCcZyhK0lTCFRRY1qLVe1VwBAHtjJHNYrQD3SZYP3hN+TPl2SHknyesc63nN19wub2HvlZTX4iKBYbVCmxjTnn8BwwUyu+mz9gIV6RuoApBWXeUjx7SH3/Y6rVX4jKUC5zymzL9vEd6h9vU1WCegS8XqF2Dc+Wv6I6SXQDnZBUPaz3PkfdfItq/wfK0lBlOduyIvvsXeov32FbbNF1e857uFBZScX8YE6jGhgiXa0RleJ0fsD86S+sVyuq0lDmhrKoOXz5gld/vqDYlLSiIboewoVcM+ccSimcd1NwFMXrDqcdtu136+IP9DhWUuJtoLcDve6ml5TcgO87aisIMexUfm2DvT42u8zm3g38zTdI1T4B6DqD7/1URNCe4/yQJ0ePyNQZs9d/mQlw5CNencMxkj/8guzrD/BqPb37sio5W62QjSJ1A4VY8/M/36NtM1Z4CdA4hsYSjCO0blqdasmzktOTNU0pSWMXXc/QdkTria2j2paTDko1/AfkFr0tGLqDWgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img.png\"\n        title=\"img.png\"\n        src=\"/static/6499be188726d9255311ea75bf9d496b/37523/img.png\"\n        srcset=\"/static/6499be188726d9255311ea75bf9d496b/e9ff0/img.png 180w,\n/static/6499be188726d9255311ea75bf9d496b/f21e7/img.png 360w,\n/static/6499be188726d9255311ea75bf9d496b/37523/img.png 720w,\n/static/6499be188726d9255311ea75bf9d496b/6bfd0/img.png 1011w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>위 아키텍처에서 주요 스케일링 병목은 AWS Step Functions 로 구현된 오케스트레이션 관리였습니다.\n우리 서비스는 스트림의 매초마다 여러 상태 전환을 수행하는데 곧 계정한도(Account Limit)에 도달했습니다.\n게다가 AWS Step Functions 의 상태 전이를 수행할 때 마다 요금이 부과됐습니다.</p>\n<p>두 번째로 발견한 비용 문제는 비디오 프레임을 여러 컴포넌트에 전달하는 방식이었습니다.\n연산 비용이 높은 비디오 변환 작업을 줄이기 위해 비디오를 프레임으로 분할하고 일시적으로 이미지를 S3 버킷에 업로드 하는 마이크로서비스를 구축했습니다.\n이후 <code class=\"language-text\">Defect Detectors</code> 는(각각 별도의 마이크로서비스로 실행됨) 이미지를 다운받고 AWS Lambda 를 사용하여 동시에 처리합니다.\n그러나 S3 버킷에 <code class=\"language-text\">Tier-1</code> 호출 수가 많아짐에 따라 비용 역시 높아졌습니다.</p>\n<blockquote>\n<p>Amazon S3에서는 다른 액세스 패턴 및 비용 구조를 가진 객체를 저장하는 여러 티어 (저장 클래스)가 있습니다. Tier-1은 빈번한 액세스 데이터에 최적화된 표준 저장 클래스를 나타냅니다.</p>\n</blockquote>\n<br/>\n<h3 id=\"마이크로-서비스에서-모놀리스-애플리케이션까지\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%9D%B4%ED%81%AC%EB%A1%9C-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%97%90%EC%84%9C-%EB%AA%A8%EB%86%80%EB%A6%AC%EC%8A%A4-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EA%B9%8C%EC%A7%80\" aria-label=\"마이크로 서비스에서 모놀리스 애플리케이션까지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마이크로 서비스에서 모놀리스 애플리케이션까지</h3>\n<p>병목 현상을 해결하기 위해, 먼저 개별 문제를 해결하여 비용을 절감하고 확장 가능성을 높일 수 있는 방법을 고려했습니다.\n우리 팀은 고심끝에 대담한 결정을 내렸는데, 인프라를 재설계하기로 결정한 것 입니다.</p>\n<p>분산 서버 환경이 우리의 케이스(Defect Detection)와 큰 이점이 없다는걸 깨달았기에 모든 구성 요소를 단일 프로세스로 통합했습니다.\n이로써 데이터 전송이 메모리 내에서 처리되므로 비디오 프레임의 중간 저장소인 S3 버킷이 불필요했습니다.\n또한 단일 인스턴스 내에서 컴포넌트를 제어하는 형태로 오케스트레이션을 구현했습니다.\n아래의 다이어그램은 모놀리스 애플리케이션으로 마이그레이션 된 시스템 아키텍처 입니다. <br/></p>\n<p><strong>📌 모든 컴포넌트가 단일 ECS 내에서 실행되는 시스템으로 업데이트된 아키텍처</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACF0lEQVQoz3WTS08TURTH+4H8In4BQ7owAdLGuBLduNOliUYXJmxcgAYT4wJfMSBiSIxoUAqIoCDQ2qZVSmf6Zu6d+/qZmaHlPcmZ3Jz/vb9z7jnnppxznPdprenpzjqctn3tvHOp6GeMOWbW2hhW+FNCCJnA9yWN/D8CKTHGHoMehfeBzppY6IkRcLdaJVQq9tVqNcrlMn69jrGHwJOZpiKHdRC5bbx28brb7eL5dbROAkkpEUIgpKTRbOJ5HmEYnp2h8oqo3DjYAGQDXLJRin2wiiRccshqiQw6qKCJNeo0cM/zsaLF1MRDBgYuMTx4maGhQbLZLCMj17h6JUtmeJBMJkM6nWZsbDwBK4E7AuxZSimNMZpmo0sxX6FcqvBjbZ1CPs9WsULud5n55V/klpYoFPJxXbU1GJ0A3Ulg3IBQsFnKsVH7Tl3WaDcatDQ8mFrlyeQb7j17x/SGf2pEelfulaNfQx1KHi/e4eZsmtc/J2Kh2IXbd++zcOMC49cvMjq7TtPz+bIzx9utp3wtzrDfaVOtVmm32hT8HSqtUgJ0RhPKDkEYoA6iNqXj+ccVPky/5MXUDPPbtTiR2e1JRr/d4tXaI5w2yKjTDpZLi6z/XU2AUeoR9OhIiSCgurfHbqNLKwjPfBWuf2XiOfU9/xBoZCeupZZBbNHmna1N5t5Ps/D5E+GBzyiB1gIt2jh92JToISil+A92wIN5en9DuQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img_1.png\"\n        title=\"img_1.png\"\n        src=\"/static/bd59b8821ffb44b26e44d10589958831/37523/img_1.png\"\n        srcset=\"/static/bd59b8821ffb44b26e44d10589958831/e9ff0/img_1.png 180w,\n/static/bd59b8821ffb44b26e44d10589958831/f21e7/img_1.png 360w,\n/static/bd59b8821ffb44b26e44d10589958831/37523/img_1.png 720w,\n/static/bd59b8821ffb44b26e44d10589958831/302a4/img_1.png 1080w,\n/static/bd59b8821ffb44b26e44d10589958831/afa26/img_1.png 1258w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n<br/></p>\n<p>개념적으로 High-level 아키텍처는 <code class=\"language-text\">미디어 변환</code>, <code class=\"language-text\">Detector</code>, <code class=\"language-text\">오케스트레이션</code> 등 초기 설계와 동일한 컴포넌트로 유지했습니다.\n덕분에 많은 코드를 재사용하여 새로운 아키텍처로 빠르게 마이그레이션 할 수 있었습니다,.</p>\n<p>초기 설계에서는 여러 개의 Detector가 별도의 마이크로 서비스로 실행됐기 때문에 수평적 확장이 가능했습니다.\n(새 Detector를 추가하려면 새로운 마이크로 서비스를 생성하여 오케스트레이션에 연결해야 했습니다)\n그러나 개선된 아키텍처는 모든 Detector가 동일한 인스턴스에서 실행되어 Detector의 수가 수직적으로만 확장됩니다.\n프라임 팀에서는 지속적으로 새로운 Detector를 추가하고 있으며, 이미 단일 인스턴스의 용량을 초과한 상태입니다.\n이 문제를 해결하기 위해 각 복제본을 다른 하위 집합의 Detector로 매개변수화 하여 서비스를 여러 번 복제했습니다.\n또한 고객 요청을 분산하기 위해 경량 오케스트레이션 레이어를 구현했습니다.</p>\n<p>아래 다이어그램은 단일 인스턴스의 용량이 초과될 때 탐지기를 배포하는 솔루션입니다. <br/></p>\n<p><strong>📌 새로운 Detector를 배포할 때 접근방식</strong>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 111.11111111111111%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAADIUlEQVQ4y42US6/bRBTHs+IzoH4vvgcSGzZdsWHDR2DFCgmkUlWqACEhKrUq4nXb5BInN3FeN4ljOzOeGdvz/qMZJ7lJ76XqkUYe2+Pf+Z+HTw8AvPfhAuccrLX3VrDb9RbJeBLPBGuXJcgfU0ipoLSG1iY+750DdXyh7wGNsZgvb5GMp2jaNp6l6xy70QLlnkAbA8p4dNYLsCPQGHPan5vRGhWl4IxBSYlZOsPLVy9x9fYN+v0+KKVoWglrXafwaEHNMaRzR7u8wHSVoT34apoaRVGAEIKqquC9g6gb2KAwAIQQ4JyjaZoTJF4DNEpsoacvIAZPAb7CQ3ahcLvdYjqdRnDw5p3tFLquIGbzL9jjR1Cf9+BffNkBBANj7CSG0KrL4dGD8x7WGlxk8FisdYLtpx+DfvYR7G9fnYBlWSJNU5Tl/g54lyuPUHg9ewVz/R20KKBYBsV20HQN8ecT5L9+DXrzGrKp4NoKTlaQvISTNFbfHhVGoLMIAVbPvkD9zScw9R6KrqHoBkq2UADmhcAoXaCumy6AYzHbKobtnL/sw9AeimTQNINpGUxDoZoKpNiipjtwkoOWGTgNqjisFLCqgakLiLq+y+GpsZWCFiWs5B2MrsE3IzCSwzV7GJ7BGwlWkai82SRxSbK4a5tzYGhali/hlegSP/wFapvE0Iwoo7NgcjdBc/3zoW4O9X4JLurIuQB65+KHIZzQ3uTqOfj8Ku47YNH9dosB8t+/h1QK3hm0ZHXqiAeBXoqY+NEkxfhmAsYFbL2PhQr7ZHyDwXCM4TCBEAyK3kalDwBtBBq2Q7acYNz/C4vxAMVmDl1l0DyHbiqw/RarNAHJ19ANgSSr+0B/aGQbq0tiUZxksddMS+OHLcvRRnABU5dxySqDZPllyOcqT/fvDIguAoBzgclkivl8gWQ0wmw2j+PryLgM+QA4X8dK7kWJjGzhvEUtQo5r1LWA1upCUA//Y+dAZSSeD3/AT8kzpOXNg2cvFH4I9MfkKZ70v0Ul6WGYuHei8O8Hnh8O/+k/13/jejQAq9i99+f2wcAw9tNpGif0+4D/AdpCofh7MnMRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"img_2.png\"\n        title=\"img_2.png\"\n        src=\"/static/9d30f6af72fb47fd3143baa1e4c76300/37523/img_2.png\"\n        srcset=\"/static/9d30f6af72fb47fd3143baa1e4c76300/e9ff0/img_2.png 180w,\n/static/9d30f6af72fb47fd3143baa1e4c76300/f21e7/img_2.png 360w,\n/static/9d30f6af72fb47fd3143baa1e4c76300/37523/img_2.png 720w,\n/static/9d30f6af72fb47fd3143baa1e4c76300/a0209/img_2.png 725w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<br/>\n<h3 id=\"결과와-시사점\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EA%B3%BC%EC%99%80-%EC%8B%9C%EC%82%AC%EC%A0%90\" aria-label=\"결과와 시사점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결과와 시사점</h3>\n<p>마이크로서비스와 서버리스 컴포넌트는 대규모 서비스에서 잘 동작하는 아키텍처지만, 모놀리스 서비스를 대신하여 사용할지 여부는 케이스에 따라 결정해야 합니다.\n모놀리스 서비스로 전환하면서 인프라 비용이 90% 이상 절감됐고 스케일링 기능도 향상됐습니다.\n현재 수천개의 스트림을 처리할 수 있으며 서비스를 더욱 확장할 수 있는 용량을 확보했습니다.\n또한 EC2와 ECS로 이전함으로써 EC2 Computing 절약 요금제를 사용할 수 있어 더 높은 비용 절감을 기대할 수 있습니다.</p>\n<p>우리가 내린 몇 가지 결정 중 분명하지 않은 점도 있었지만 명확한 개선점은 있었습니다.\n예를 들어, Computing 비용이 많이 드는 미디어 변환 프로세스를 복제하여 Detector와 더 가까운 곳에 배치했습니다.\n비용 측면에서 미디어 변환을 한 번만 실행하여 그 결과를 캐싱하는 방법도 괜찮은 옵션이지만,\n이것이 비용측면에서 효율적인 접근이 아니라는 점을 알게 됐습니다.</p>\n<p>이로써 프라임 비디오는 시청자 수가 가장 많은 영상 뿐 아니라, 유저들이 시청하는 모든 스트림을 모니터링 할 수 있는 시스템으로 개선되어 더 높은 품질과 나은 고객 경험을 제공할 수 있게 됐습니다.</p>","frontmatter":{"date":"May 07, 2023","title":"Prime Video 서비스의 오디오/비디오 모니터링 서비스 확장 및 비용 절감 90% 사례","categories":"Architecture","author":"Hoo","emoji":"🌿🤙🏻"},"fields":{"slug":"/Scailing up the Prime Video/"}},"site":{"siteMetadata":{"siteUrl":"https://www.zoomkoding.com","comments":{"utterances":{"repo":""}}}}},"pageContext":{"slug":"/Springboot 원리/","nextSlug":"/글또 8기 다짐/","prevSlug":"/Scailing up the Prime Video/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}